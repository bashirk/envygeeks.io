# --
# envygeeks.io.conf:997f5ff88b61c25f9fb9f0ec9c8540b298896753
# Configuration for envygeeks.io
# --
server {
  ssl_certificate_key /var/ssl/997f5ff88b61c25f9fb9f0ec9c8540b298896753.key;
  ssl_trusted_certificate /var/ssl/997f5ff88b61c25f9fb9f0ec9c8540b298896753.crt;
  ssl_certificate /var/ssl/997f5ff88b61c25f9fb9f0ec9c8540b298896753.crt;
  set $key_non 'zkxIjxkAib12eto3YTntgZ0i+mysjFZ8BpiUWMZLoOE=';
  set $key_sha 'zkxIjxkAib12eto3YTntgZ0i+mysjFZ8BpiUWMZLoOE=';

  server_name envygeeks.io;
  root /srv/nginx/envygeeks.io;
  rewrite ^/(.*)/$ /$1 permanent;
  listen 443 ssl spdy;
  listen 80;

  location / {
    add_header Access-Control-Allow-Origin "*";
    add_header Access-Control-Allow-Methods "GET, HEAD, OPTIONS";
    add_header Strict-Transport-Security "max-age=16590000; includeSubDomains; preload";
    add_header Public-Key-Pins "pin-sha256=\"${key_sha}\"; pin-sha256=\"${key_non}\"; max-age=16590000; includeSubDomains; preload";
    add_header Access-Control-Allow-Headers "DNT,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type";
    add_header Cache-Control "private, max-age=0, proxy-revalidate, no-store, no-cache, must-revalidate";
    add_header Access-Control-Max-Age 2592000;
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options DENY;
    add_header Pragma "private";
    etag off;

    try_files $uri.html $uri $uri/ =404;
  }

  # --
  # Make sure assets have a far-future cache.
  # --
  location ^~ /assets/ {
    access_log off;
    error_log  off;
    expires 1y;

    add_header Cache-Control "public";
    add_header Access-Control-Allow-Origin "*";
    add_header Access-Control-Allow-Methods "GET, HEAD, OPTIONS";
    add_header Strict-Transport-Security "max-age=16590000; includeSubDomains; preload";
    add_header Public-Key-Pins "pin-sha256=\"${key_sha}\"; pin-sha256=\"${key_non}\"; max-age=16590000; includeSubDomains; preload";
    add_header Access-Control-Allow-Headers "DNT,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type";
    add_header Access-Control-Max-Age 2592000;
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options DENY;
    add_header Pragma "public";
  }
}

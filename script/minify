#!/bin/bash -l
. script/base/env
set -e

args="--html5 --minify-js --minify-css --remove-comments
--collapse-whitespace --remove-tag-whitespace --collapse-boolean-attributes
--remove-style-link-type-attributes --remove-script-type-attributes
--remove-redundant-attributes --remove-attribute-quotes
--quote-character=\""

if [ -t 0 ]; then
  node_modules/.bin/postcss --no-map --config=script/file/postcss.js 2> /dev/null \
  site/assets/*.css --dir=site/assets; \
  node_modules/.bin/html-minifier $args \
    --output-dir=site/ --input-dir=site/ \
    --file-ext=html
else
  node_modules/.bin/html-minifier \
    $args <&0
fi
